# Copy and run from source root (directory has to contain cloudify-common, cloudify-agent, cloudify-manager)


version: "3.8"

services:
  manager:
    container_name: manager
    image: cloudify-manager-aio
    volumes:
      - ./config.yaml:/etc/cloudify/config.yaml
      - ./cloudify_internal_ca_cert.pem:/tmp/cloudify_internal_ca_cert.pem
      - ./cloudify_internal_ca_key.pem:/tmp/cloudify_internal_ca_key.pem
    networks:
      - cloudify
    restart: unless-stopped

  mgmtworker:
    container_name: mgmtworker
    build:
      context: .
      dockerfile: cloudify-manager/mgmtworker/Dockerfile
    env_file:
      - .env
    environment:
      - ADMIN_API_TOKEN=${ADMIN_API_TOKEN}
      - REST_HOST=${REST_HOST:-manager}
      - REST_PORT=${REST_PORT:-53333}
      - LOCAL_REST_CERT_FILE=${LOCAL_REST_CERT_FILE:-/usr/src/app/mgmtworker/cloudify_internal_ca_cert.pem}
      - AGENT_WORK_DIR=${AGENT_WORK_DIR:-/usr/src/app/mgmtworker}
      - MANAGER_NAME=${MANAGER_NAME:-cloudify-manager}
    volumes:
      - ./cloudify_internal_ca_cert.pem:/usr/src/app/mgmtworker/cloudify_internal_ca_cert.pem
      - ./cloudify-manager/resources/rest-service/cloudify/types:/opt/manager/resources/cloudify/types
    networks:
      - cloudify
    restart: unless-stopped

networks:
  cloudify:
    driver: bridge
    name: cloudify
