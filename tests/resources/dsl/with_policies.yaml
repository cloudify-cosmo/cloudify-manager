imports:
    - cloudify.types
    - testmockoperations.yaml
    - mock_workflows.yaml
    - policies/threshold.yaml
    - triggers/execute_workflow.yaml

node_templates:
    node:
        type: cloudify.types.base
        interfaces:
            test:
                - op1: testmockoperations.testmockoperations.tasks.mock_operation_from_custom_workflow

groups:
    threshold_group:
        members: [node]
        policies:
            threshold_policy:
                type: threshold
                properties:
                    metric: TODO
                    threshold: 60
                triggers:
                    threshold_exceeded_workflow:
                        type: execute_workflow
                        parameters:
                            workflow: threshold_exceeded
                            allow_custom_parameters: true
                            workflow_parameters:
                                key: node_id
                                value: { get_property: [SELF, node_id] }
                                custom_key: metric
                                custom_value: { get_property: [SELF, metric] }

workflows:
    threshold_exceeded:
        mapping: mock_workflows.mock_workflows.workflows.test_policies_1
        parameters:
            key:
                description: a key to write
            value:
                description: a value to write
